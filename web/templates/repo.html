{% extends "layout.html" %}
{% block title %}{{repo.name|basename}}{%endblock%}
	{% block body %}
		{% block repohead %}
		<div class="container row">
			<p class="pull-right">Updated {{repo.updated|naturaltime}}</p>
			<span style="font-size:20px">
			<a href="/repo/{{repo.name}}"><strong>{{repo.name}}</strong></a>
			<a href="https://{{repo.name}}" class="btn btn-info btn-xs">Source</a>
			<br>
			<span class="glyphicon glyphicon-cloud-download"></span> {{repo.down_count}}
			<!--<a href="/repo/{{repo.name}}#disqus_thread">Link</a>-->
			</span>
			<br>
			<p>{{repo.description}}</p>
			<div class="pull-left">
				<!--<a href="https://godoc.org/{{repo.name}}"><img src="https://godoc.org/{{repo.name}}?status.svg" alt="GoDoc"></a>-->
				<a href="https://gowalker.org/{{repo.name}}"><img src="http://gowalker.org/api/v1/badge" alt="GoDoc"></a>
			</div>
			<div class="pull-right" style="margin-bottom: 10px">
				<form class="form-inline" role="form" action='/task/build'>
					<div class="form-group">
						<input type="text" class="form-control" name="tag" value="{%if active_tag%}{{active_tag}}{%else%}branch:master{%endif%}">
						<input type="hidden" name="reponame" value="{{repo.name}}">
						<button class="btn btn-info">Build Now</button>
					</div>
				</form>
			</div>
			<br>
		</div>
		{% endblock %}
		{% block info %}
			<div class="container row" style="border: 0px solid gray">
				<div class="col-md-4" style="padding: 10px 10px">
					<h4>Tags</h4>
					<div class="list-group">
						{% for build in builds %}
							<a href="/repo/{{repo.name}}?tag={{build.tag}}"
								class="list-group-item
								{%if not build.downloadable%}
								disabled
								{%else%}
								{%if build.tag==active_tag%}active{%endif%}
								{%endif%}
								">
								{%if not build.downloadable%}<del>{%endif%}
								{{build.tag}}
								{%if not build.downloadable%}
								</del>
								{%else%}
								<span class="badge">
								<span class="glyphicon glyphicon-cloud-download"></span> {{build.down_count}}
								</span>
								{%endif%}
							</a>
						{% endfor %}
					</div>
				</div>
				<div class="col-md-8" style="padding: 10px 50px; border-left: 1px solid gray">
					<div class="row">
						<h4>Properies</h4>
						{% if active_build %}
							<p><span class="glyphicon glyphicon-time"></span> {{ active_build.updated|strftime }} - [used: {{20|human_duration}}]</p>
							<p>
							{{active_build.version|str2html}}
							</p>
							<a href="/task/list/{{active_build.id}}" class="btn btn-info btn-xs">build history</a>
							{% if active_build.downloadable %}
								<h5>Download</h5>
								<div>
									<table class="table">
										{% for goos, archs in ['windows',('386','amd64')], ['linux',('amd64','386','arm')], ['darwin',('amd64','386')] %}
											<tr>
												<td>
													<button platform="{{goos}}" class="download btn btn-success btn-sm" style="width: 90px; text-align: left">
													<span class="glyphicon glyphicon-save"></span> {{goos}}
													</button>
												</td>
												<td>
													{% for arch in archs %}
														<label class="radio-inline">
															<input type="radio" name="{{goos}}-arch" value="{{arch}}" {% if arch==archs[0]%}checked{%endif%}> {{arch}}
															</label>
														{% endfor %}
													</td>
													<td style="width: 40%">
														<div class="input-group">
															<input type="text" class="form-control" value="curl xxx">
															<span class="input-group-btn">
															<button class="btn btn-default" type="button">copy</button>
															</span>
														</div>
													</td>
												</tr>
											{% endfor %}
										</table>
									</div>
									<div class="well" id="well"></div>
								{% else %}
									<p>
									<strong>Build Status:</strong> {{active_build.status}}
									</p>
								{% endif %}
							{% endif %}
						</div>
					</div>
				</div>
			<script type="text/javascript">
			function saveas(url){
				var a = $("<a href='"+url+"'>download</a>").get(0);
				var e = document.createEvent('MouseEvents');
				e.initEvent( 'click', true, true );
				a.dispatchEvent(e);
			}
			$(".download").click(function(e){
					var goos = $(this).attr("platform")
					var xpath = "input[name="+goos+"-arch]:checked";
					var arch = $(xpath).val();
					$.get('/repo/retrive', {
						reponame:"{{repo.name}}", goos: goos, goarch: arch,
						tag: "{{active_tag}}",
					}, function(d){
						console.log("message", d.message);
						var well;
						if (d.status !== 0){
							well = "<span style='color:red'>"+goos+"-"+arch+"\n"+d.message+"</span>";
						} else {
							well = d.well;
						}
						well = well.replace(new RegExp('\n','g'), '<br>');
						$("#well").html(well);
						if (d.status === 0){
							saveas(d.outlink);
						}
					});
					//a.close();
					//console.log(goos+arch);
			});
			</script>
			{% endblock %}

			{% block disqus %}
			<div id="disqus_thread"></div>
			<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'gobuild'; // required: replace example with your forum shortname

			/* * * DON'T EDIT BELOW THIS LINE * * */
			$(function(){
			(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('body')[0] || document.getElementsByTagName('head')[0]).appendChild(dsq);
			})();
			});

				/* comment count */
			    (function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			    }());

			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
			{% endblock %}

		{% endblock %}
